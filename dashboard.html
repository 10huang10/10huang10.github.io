
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>è¨˜å¸³ä¸»é </title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { padding: 20px; font-family: sans-serif; }
    .form-control, .btn { margin-bottom: 10px; }
  </style>
</head>
<body>
  <header>
  <h1>æˆ‘çš„è¨˜å¸³æœ¬</h1>
  <nav>
    <a href="settings.html">è¨­å®š</a>
    <a href="currency.html">åŒ¯ç‡ç®¡ç†</a>
    <a href="analysis.html">åœ–è¡¨åˆ†æ</a>
    <a href="notify.html">é€šçŸ¥</a>
  </nav>
  <header>
  <section class="mb-4">
    <h2>æ–°å¢æ”¯å‡º / æ”¶å…¥</h2>
    <form id="recordForm">
      <input type="text" id="item" class="form-control" placeholder="é …ç›®åç¨±" required />
      <input type="number" id="amount" class="form-control" placeholder="é‡‘é¡" required />
      <select id="category" class="form-control">
        <optgroup label="ğŸ´ é£²é£Ÿ">
          <option value="æ—©é¤">ğŸ³ æ—©é¤</option>
          <option value="åˆé¤">ğŸ± åˆé¤</option>
          <option value="æ™šé¤">ğŸ² æ™šé¤</option>
          <option value="é£²æ–™">â˜•ï¸ é£²æ–™/å’–å•¡</option>
        </optgroup>
        <optgroup label="ğŸ›’ ç”Ÿæ´»æ”¯å‡º">
          <option value="é›œè²¨">ğŸ›’ è¶…å¸‚/é›œè²¨</option>
          <option value="äº¤é€š">ğŸš— äº¤é€š</option>
          <option value="å¨›æ¨‚">ğŸ‰ å¨›æ¨‚</option>
          <option value="è³¼ç‰©">ğŸ›ï¸ è³¼ç‰©</option>
          <option value="å¥åº·">ğŸ¥ å¥åº·</option>
          <option value="å…¶ä»–æ”¯å‡º">ğŸ’¸ å…¶ä»–æ”¯å‡º</option>
        </optgroup>
        <optgroup label="ğŸ’° æ”¶å…¥é¡">
          <option value="è–ªè³‡">ğŸ’¼ è–ªè³‡</option>
          <option value="çé‡‘">ğŸ çé‡‘</option>
          <option value="æŠ•è³‡">ğŸ“ˆ æŠ•è³‡æ”¶å…¥</option>
          <option value="å…¶ä»–æ”¶å…¥">ğŸ’° å…¶ä»–æ”¶å…¥</option>
        </optgroup>
      </select>
      <button type="submit" class="btn btn-primary">æ–°å¢</button>
    </form>
  </section>

  <section>
    <h2>ç´€éŒ„åˆ—è¡¨</h2>
    <ul id="recordList" class="list-group mb-4"></ul>
  </section>

  <section class="mb-4">
    <h2>æ”¶æ”¯åœ“é¤…åœ–</h2>
    <canvas id="pieChart" width="300" height="300"></canvas>
  </section>

  <section>
    <h2>æ¯æœˆå„²è“„é€²åº¦</h2>
    <input type="number" id="goalInput" class="form-control" placeholder="è«‹è¼¸å…¥å„²è“„ç›®æ¨™ï¼ˆå…ƒï¼‰" />
    <button onclick="setGoal()" class="btn btn-success">è¨­å®šç›®æ¨™</button>
    <progress id="goalProgress" value="0" max="100" class="w-100 my-2"></progress>
    <p id="progressText"></p>
  </section>

  <script>
    let records = JSON.parse(localStorage.getItem("records") || "[]");
  let goal = localStorage.getItem("savingGoal") ? parseFloat(localStorage.getItem("savingGoal")) : 0;

  document.getElementById("recordForm").addEventListener("submit", function (e) {
    e.preventDefault();
    const item = document.getElementById("item").value;
    const amount = parseFloat(document.getElementById("amount").value);
    const category = document.getElementById("category").value;
    const incomeTypes = ["è–ªè³‡", "çé‡‘", "æŠ•è³‡", "å…¶ä»–æ”¶å…¥"];
    const type = incomeTypes.includes(category) ? "income" : "expense";
    const timestamp = new Date().toISOString(); // æ–°å¢æ™‚é–“æˆ³è¨˜

    if (!item || isNaN(amount)) return;

    records.push({ item, amount, type, category, timestamp });
    localStorage.setItem("records", JSON.stringify(records));
    updateRecordList();
    updateChart();
    updateProgress();
    this.reset();
  });

  function updateRecordList() {
  const ul = document.getElementById("recordList");
  ul.innerHTML = "";
  records.forEach((r, i) => {
    let time = "ç„¡æ™‚é–“ç´€éŒ„";
    if (r.timestamp) {
      const parsed = new Date(r.timestamp);
      if (!isNaN(parsed)) {
        time = parsed.toLocaleString("zh-TW");
      }
    }

    const li = document.createElement("li");
    li.className = "list-group-item d-flex justify-content-between align-items-start flex-column";
    li.innerHTML = `<div>${r.category} - ${r.item}ï¼š${r.amount} å…ƒ</div><small class="text-muted">è¨˜å¸³æ™‚é–“ï¼š${time}</small>`;

    const btn = document.createElement("button");
    btn.className = "btn btn-danger btn-sm align-self-end";
    btn.textContent = "åˆªé™¤";
    btn.onclick = function () {
      records.splice(i, 1);
      localStorage.setItem("records", JSON.stringify(records));
      updateRecordList();
      updateChart();
      updateProgress();
    };
    li.appendChild(btn);
    ul.appendChild(li);
  });

  }

    function updateChart() {
      const income = records.filter(r => r.type === "income").reduce((sum, r) => sum + r.amount, 0);
      const expense = records.filter(r => r.type === "expense").reduce((sum, r) => sum + r.amount, 0);
      const ctx = document.getElementById("pieChart").getContext("2d");
      if (window.pieChartInstance) window.pieChartInstance.destroy();
      window.pieChartInstance = new Chart(ctx, {
        type: 'pie',
        data: {
          labels: ['æ”¶å…¥', 'æ”¯å‡º'],
          datasets: [{
            data: [income, expense],
            backgroundColor: ['#4CAF50', '#FF5252']
          }]
        }
      });
    }

    function setGoal() {
      const goalInput = parseFloat(document.getElementById("goalInput").value);
      if (!goalInput || goalInput <= 0) return alert("è«‹è¼¸å…¥æœ‰æ•ˆçš„å„²è“„ç›®æ¨™ï¼");
      goal = goalInput;
      localStorage.setItem("savingGoal", goal);
      updateProgress();
    }

    function updateProgress() {
      const income = records.filter(r => r.type === "income").reduce((sum, r) => sum + r.amount, 0);
      const expense = records.filter(r => r.type === "expense").reduce((sum, r) => sum + r.amount, 0);
      const remaining = income - expense;
      const progress = goal > 0 ? Math.min(100, Math.floor((remaining / goal) * 100)) : 0;

      document.getElementById("goalProgress").value = progress;
      document.getElementById("progressText").innerText = `ç›®å‰å„²è“„ï¼š${remaining} / ç›®æ¨™ï¼š${goal}ï¼ˆ${progress}%ï¼‰`;
    }
    document.addEventListener("DOMContentLoaded", function () {
    const savedTheme = localStorage.getItem("theme") || "light";
    document.body.className = savedTheme;
  });
  const lang = localStorage.getItem("lang") || "zh";
  if (lang === "en") {
    document.getElementById("pageTitle").textContent = "My Budget Book";
  } else {
    document.getElementById("pageTitle").textContent = "æˆ‘çš„è¨˜å¸³æœ¬";
  }

    updateRecordList();
    updateChart();
    updateProgress();
  </script>
</body>
</html>
